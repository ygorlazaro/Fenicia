@page "/register"
@using Fenicia.Common.Database.Requests
@using Fenicia.Web.Components.Layout
@using Fenicia.Web.Providers.Auth

@rendermode InteractiveServer

@inject RegisterProvider RegisterProvider
@inject NavigationManager NavigationManager;


@layout GuestLayout

<style>
    img {
        margin-top: 30px;
        width: 50%;
        height: auto;
        margin-bottom: 1rem;
    }
</style>

<PageTitle>Fenicia - Register</PageTitle>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="text-center">
                <img src="images/logo.jpeg" alt="Fenicia Logo" class="img-fluid rounded rounded-5" />
            </div>
            <div class="card mt-4 p-4 rounded-5">
                <div class="card-body">
                    <h2 class="card-title">Register</h2>
                    <EditForm Model="@model" OnValidSubmit="OnValidSubmit" FormName="LoginForm">
                        <DataAnnotationsValidator />
                        <div class="form-group">
                            <label for="companyName" class="control-label">Company Name</label>
                            <div class="input-group">
                                <InputText id="companyName" @bind-Value="@model.Company.Name" class="form-control" />
                            </div>
                            <ValidationMessage For="@(() => model.Company.Name)" class="text-danger" />
                        </div>
                        <div class="form-group">
                            <label for="cnpj" class="control-label">CNPJ</label>
                            <div class="input-group">
                                <InputText id="cnpj" @bind-Value="@model.Company.Cnpj" class="form-control" />
                            </div>
                            <ValidationMessage For="@(() => model.Company.Cnpj)" class="text-danger" />
                        </div>
                        <div class="form-group">
                            <label for="name" class="control-label">Name</label>
                            <div class="input-group">
                                <InputText id="name" @bind-Value="@model.Name" class="form-control" />
                            </div>
                            <ValidationMessage For="@(() => model.Email)" class="text-danger" />
                        </div>
                        <div class="form-group">
                            <label for="email" class="control-label">Email</label>
                            <div class="input-group">
                                <InputText id="email" @bind-Value="@model.Email" class="form-control" type="email" />
                            </div>
                            <ValidationMessage For="@(() => model.Email)" class="text-danger" />
                        </div>
                        <div class="form-group">
                            <label for="password" class="control-label">Password</label>
                            <div class="input-group">
                                <InputText id="password" @bind-Value="@model.Password" class="form-control"
                                    type="password" />
                            </div>
                            <ValidationMessage For="@(() => model.Password)" class="text-danger" />
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-primary">Login</button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private readonly UserRequest model = new() { Company = new CompanyRequest() };

    private async Task OnValidSubmit()
    {
        await RegisterProvider.RegisterAsync(model);

        NavigationManager.NavigateTo("/");
    }
}
