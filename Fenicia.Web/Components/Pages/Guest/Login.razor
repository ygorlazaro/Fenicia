@page "/"
@using Fenicia.Common.Database.Requests
@using Fenicia.Web.Components.Layout
@using Fenicia.Web.Providers.Auth

@rendermode InteractiveServer

@inject TokenProvider TokenProvider
@inject NavigationManager Navigation


@layout GuestLayout

<style>
    img {
        margin-top: 30px;
        width: 50%;
        height: auto;
        margin-bottom: 1rem;
    }
</style>

<PageTitle>Fenicia - Login</PageTitle>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="text-center">
                <img src="images/logo.jpeg" alt="Fenicia Logo" class="img-fluid rounded rounded-5" />
            </div>
            <div class="card mt-4 p-4 rounded-5">
                <div class="card-body">
                    <h2 class="card-title">Login</h2>
                    <EditForm Model="@_model" OnValidSubmit="OnValidSubmit" FormName="LoginForm">
                        <DataAnnotationsValidator />
                        <div class="form-group">
                            <label for="cnpj" class="control-label">CNPJ</label>
                            <div class="input-group">
                                <InputText id="cnpj" @bind-Value="@_model.Cnpj" class="form-control" />
                            </div>
                            <ValidationMessage For="@(() => _model.Cnpj)" class="text-danger" />
                        </div>
                        <div class="form-group">
                            <label for="email" class="control-label">Email</label>
                            <div class="input-group">
                                <InputText id="email" @bind-Value="@_model.Email" class="form-control" type="email" />
                            </div>
                            <ValidationMessage For="@(() => _model.Email)" class="text-danger" />
                        </div>
                        <div class="form-group">
                            <label for="password" class="control-label">Password</label>
                            <div class="input-group">
                                <InputText id="password" @bind-Value="@_model.Password" class="form-control"
                                    type="password" />
                            </div>
                            <ValidationMessage For="@(() => _model.Password)" class="text-danger" />
                        </div>
                        <div class="form-group mt-3">
                            <button type="submit" class="btn btn-primary">Login</button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private readonly TokenRequest _model = new();

    private async Task OnValidSubmit()
    {
        await TokenProvider.DoLoginAsync(_model);

        Navigation.NavigateTo("/home");
    }
}
