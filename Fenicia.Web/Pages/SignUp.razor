@page "/signup"
@layout EmptyLayout
@using Fenicia.Web.Models
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Sign Up</h3>

<EditForm Model="@_signUpRequest" OnValidSubmit="HandleSignUp">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label>Name:</label>
        <InputText @bind-Value="_signUpRequest.Name" class="form-control" />
    </div>
    <div class="form-group">
        <label>Email:</label>
        <InputText @bind-Value="_signUpRequest.Email" class="form-control" />
    </div>
    <div class="form-group">
        <label>Password:</label>
        <InputText @bind-Value="_signUpRequest.Password" type="password" class="form-control" />
    </div>

    <h4>Company</h4>
    <div class="form-group">
        <label>Company Name:</label>
        <InputText @bind-Value="_signUpRequest.Company.Name" class="form-control" />
    </div>
    <div class="form-group">
        <label>Company CNPJ:</label>
        <InputText @bind-Value="_signUpRequest.Company.Cnpj" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Sign Up</button>
</EditForm>

@code {
    private readonly SignUpRequest _signUpRequest = new();

    private async Task HandleSignUp()
    {
        var response = await Http.PostAsJsonAsync(requestUri: "http://localhost:5144/signup", _signUpRequest);
        if (response.IsSuccessStatusCode)
        {
            Navigation.NavigateTo(uri: "/login");
        }
        else
        {
            // Handle error
        }
    }
}
