

# Fenicia SaaS Platform â€“ Auth Service

<a href="https://discord.gg/RNuSz2t4wm" target="_blank"><img src="https://img.shields.io/discord/1245739632657489950?label=Join%20our%20Discord&logo=discord&style=for-the-badge" alt="Discord"></a>

![Build Status](https://img.shields.io/github/actions/workflow/status/ygorlazaro/Fenicia/ci.yml?branch=develop&style=for-the-badge)
![Tests](https://img.shields.io/badge/tests-passing-brightgreen?style=for-the-badge)
![Coverage](https://img.shields.io/badge/coverage-unknown-lightgrey?style=for-the-badge)

---

**[CONTRIBUTING.md](CONTRIBUTING.md) | [CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md) | [LICENSE](LICENSE) | [SECURITY.md](SECURITY.md) | [LINKEDIN.MD](LINKEDIN.MD) | [LINKEDIN_EN.MD](LINKEDIN_EN.MD) | [Docs](docs/README.md)**

---

## ğŸŒ Demo & Showcase

> At future

---

## ğŸ§© Project Architecture

- **Multi-tenant by database**: Each company has its own database (physical isolation).
- **Modularity**: Each feature is a decoupled microservice (e.g., Auth, Basic, Social, HR, etc.).
- **Centralized JWT**: `AuthService` is the only service responsible for authenticating users and issuing valid tokens for other modules.
- **JWT Claims**:
  - `sub` (User ID)
  - `companyId` (Company ID)
  - `modules` (array with subscribed modules)
  - `tenantId` (used to build the connection string for services)

---

## ğŸš€ How to run locally

### Prerequisites

- [.NET 9 SDK](https://dotnet.microsoft.com/download)
- [PostgreSQL](https://www.postgresql.org/download/)
- [RabbitMQ (optional, but recommended)](https://www.rabbitmq.com/download.html)
- [Docker (optional, for easier setup)]

---

### ğŸ”§ Configuration

1. **Create the base database (admin/central)**:
   This is where `AuthService` operates and stores information such as users, companies, and tokens.

2. **Configure the connection string** in `appsettings.Development.json`:

```json
{
  "ConnectionStrings": {
    "TenantTemplate": "Host=localhost;Port=5432;Database=tenant_{tenant};Username=postgres;Password=senha",
    "Default": "Host=localhost;Port=5432;Database=auth_db;Username=postgres;Password=senha"
  },
  "Jwt": {
    "Issuer": "fenicia-auth",
    "Audience": "fenicia-clients",
    "Secret": "super-secret-key"
  }
}
```

3. **Run migrations** for the Auth database:

```bash
dotnet ef database update --project Fenicia.Module.Auth
```

To run tenant migrations:

```bash
dotnet run --project Fenicia.Module.Auth -- --migrate-tenants
```

*(This will execute logic that iterates all registered tenants and runs migrations for each one.)*

---

## ğŸ Running the application

```bash
dotnet run --project Fenicia.Module.Auth
```

---

## ğŸ›  Project Structure

- `Fenicia.Common`: Utilities, interfaces, and providers reused by modules.
- `Fenicia.Module.Auth`: Responsible for:
  - User registration/login
  - Company creation
  - Module subscription
  - JWT generation
- `Fenicia.Module.Basic` (and others): Consume the JWT generated by Auth and access their own databases via `tenantId`.

---

## ğŸ” Security

- JWT tokens are required for any request to modules.
- Authorization middleware checks if the token has permission for the accessed module (`Claim: modules`).
- Multi-tenancy configured via dynamic connection string, based on the `tenantId` in the token.

---

## ğŸ“¬ Service Communication

- Uses RabbitMQ for internal events and module integration.
- Example: When a new company is created in `AuthService`, an event can be sent to `BasicService` to initialize default data in the company's database.

---

## âœ… TODO / Roadmap

- [ ] Rate limit and lockout after many login attempts
- [ ] Admin panel to manage companies and modules
- [ ] Integration with payment gateways for billing

---

## ğŸ“„ License

This project is free for use and private distribution during development. All rights reserved to the Fenicia team.
